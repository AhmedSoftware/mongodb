# -*- mode: python -*-

Import("env")

env = env.Clone()

# WorkingSet target and associated test
env.Library(
    target = "working_set",
    source = [
        "working_set.cpp",
        "working_set_computed_data.cpp"
    ],
    LIBDEPS = [
        "$BUILD_DIR/merizo/base",
        "$BUILD_DIR/merizo/db/bson/dotted_path_support",
        "$BUILD_DIR/merizo/db/service_context",
    ],
)

env.CppUnitTest(
    target = "working_set_test",
    source = [
        "working_set_test.cpp"
    ],
    LIBDEPS = [
        "working_set",
    ],
)

env.Library(
    target = "scoped_timer",
    source = [
        "scoped_timer.cpp",
    ],
    LIBDEPS = [
        '$BUILD_DIR/merizo/util/net/network',
    ],
)

env.Library(
    target='stagedebug_cmd',
    source=[
        'stagedebug_cmd.cpp'
    ],
    LIBDEPS=[
        "$BUILD_DIR/merizo/db/index/index_access_methods",
        "$BUILD_DIR/merizo/db/query_exec",
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/merizo/db/commands/test_commands_enabled',
    ],
)

env.CppUnitTest(
    target = "queued_data_stage_test",
    source = [
        "queued_data_stage_test.cpp",
    ],
    LIBDEPS = [
        "$BUILD_DIR/merizo/db/auth/authmocks",
        "$BUILD_DIR/merizo/db/query_exec",
        "$BUILD_DIR/merizo/db/service_context_d_test_fixture",
        "$BUILD_DIR/merizo/dbtests/mocklib",
        "$BUILD_DIR/merizo/util/clock_source_mock",
    ],
)

env.CppUnitTest(
    target = "sort_test",
    source = [
        "sort_test.cpp",
    ],
    LIBDEPS = [
        "$BUILD_DIR/merizo/db/auth/authmocks",
        "$BUILD_DIR/merizo/db/query_exec",
        "$BUILD_DIR/merizo/db/service_context_d_test_fixture",
        "$BUILD_DIR/merizo/dbtests/mocklib",
        "$BUILD_DIR/merizo/db/query/collation/collator_factory_mock",
        "$BUILD_DIR/merizo/db/query/collation/collator_interface_mock",
        "$BUILD_DIR/merizo/util/clock_source_mock",
    ],
)

env.CppUnitTest(
    target = "projection_exec_test",
    source = [
        "projection_exec_test.cpp",
    ],
    LIBDEPS = [
        "$BUILD_DIR/merizo/db/auth/authmocks",
        "$BUILD_DIR/merizo/db/query_exec",
        "$BUILD_DIR/merizo/db/query/collation/collator_interface_mock",
        "$BUILD_DIR/merizo/db/query/query_test_service_context",
        "$BUILD_DIR/merizo/db/service_context_d",
    ],
)

env.CppUnitTest(
    target='projection_exec_agg_test',
    source=[
        'projection_exec_agg_test.cpp',
    ],
    LIBDEPS=[
        '$BUILD_DIR/merizo/base',
        '$BUILD_DIR/merizo/db/projection_exec_agg',
    ],
)
